<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Performance Predictor</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <!-- Top Navigation -->
    <header class="navbar">
      <div class="nav-left">
        <a href="/" class="brand">üéì Student Predictor</a>
      </div>
      <div class="nav-right">
        <a href="{{ url_for('start') }}" class="btn btn-secondary btn-nav"
          >Back</a
        >
        <a href="{{ url_for('logout') }}" class="btn btn-primary btn-nav"
          >Logout</a
        >
      </div>
    </header>

    <div class="container">
      <!-- Header -->
      <div class="header hero">
        <h1>Performance Predictor</h1>
        <p class="subtitle">
          AI-Powered Grade Prediction ‚Ä¢ Linear Regression Analysis ‚Ä¢ Pass/Fail
          Insights
        </p>
        <div
          id="session-info"
          data-name="{{ student_name if student_name is defined else '' }}"
          data-sem="{{ semesters_completed if semesters_completed is defined else 0 }}"
          data-dept="{{ department if department is defined else '' }}"
        ></div>
        <div class="student-display" id="student-display"></div>
      </div>

      <!-- Metrics Section -->
      <section class="metrics-section">
        <h2 class="section-title">Model Performance</h2>
        <div class="metrics-grid">
          <div class="metric-card">
            <label>R¬≤ Score</label>
            <div class="metric-value" id="r2-value">--</div>
            <div class="metric-progress">
              <div
                class="metric-progress-bar"
                id="r2-bar"
                style="width: 0%"
              ></div>
            </div>
            <div class="metric-desc">Variance explained</div>
          </div>
          <div class="metric-card">
            <label>RMSE</label>
            <div class="metric-value" id="rmse-value">--</div>
            <div class="metric-progress">
              <div
                class="metric-progress-bar"
                id="rmse-bar"
                style="width: 0%"
              ></div>
            </div>
            <div class="metric-desc">Lower is better</div>
          </div>
          <div class="metric-card">
            <label>MAE</label>
            <div class="metric-value" id="mae-value">--</div>
            <div class="metric-progress">
              <div
                class="metric-progress-bar"
                id="mae-bar"
                style="width: 0%"
              ></div>
            </div>
            <div class="metric-desc">Lower is better</div>
          </div>
          <div class="metric-card">
            <label>Test Samples</label>
            <div class="metric-value" id="samples-value">--</div>
            <div class="metric-desc">Evaluated</div>
          </div>
        </div>
      </section>

      <!-- Input Section -->
      <section class="input-section">
        <h2 class="section-title">Academic Performance</h2>
        <p class="semester-info">
          üìä Enter subject grades for each completed semester. SGPA will be
          automatically calculated based on your grades and credit hours.
        </p>
        <!-- Grade-entry instruction and dynamic subject-grade inputs -->
        <div class="grade-entry-instructions">
          <h3>Grade Entry Instructions</h3>
          <p>
            Enter grades for the following Semesters. Select a letter grade for
            each subject. The semester SGPA will be automatically calculated.
          </p>

          <div id="subject-grades-container">
            <!-- Dynamic subject-grade inputs will be rendered here by script.js -->
          </div>
          <!-- Attendance inputs for n semesters -->
          <div
            id="attendance-section"
            class="grade-entry-instructions"
            style="margin-top: 14px"
          >
            <h3>Attendance Entry</h3>
            <p>
              Enter attendance percentage (0-100) for each subject in your
              current semester.
            </p>
            <div id="attendance-container"><!-- rendered by script.js --></div>
          </div>

          <!-- Midterm marks for current semester -->
          <div
            id="midterm-section"
            class="grade-entry-instructions"
            style="margin-top: 14px"
          >
            <h3>Midterm Marks</h3>
            <p>
              Enter midterm marks (0-50) for each subject in your current
              semester.
            </p>
            </p>
            <div id="midterm-container"><!-- rendered by script.js --></div>
          </div>
        </div>
      </section>

      <!-- Results Section -->
      <section
        class="results-section"
        id="results-section"
        style="display: none"
      >
        <h2 class="section-title">Prediction Results</h2>
        <div class="results-container">
          <div class="result-item">
            <span class="result-label">Current Average SGPA:</span>
            <span class="result-value" id="current-avg">--</span>
          </div>
          <div class="result-item">
            <span class="result-label">Performance Trend:</span>
            <span class="result-value" id="trend">--</span>
          </div>
          <div class="result-item full-width">
            <span class="result-label">Grade Counts:</span>
            <div class="grade-counts-grid" id="grade-counts-grid">--</div>
          </div>
          <div class="result-item full-width">
            <span class="result-label">Performance Graph:</span>
            <div class="performance-graph-container" id="performance-graph">
              <canvas id="performance-chart"></canvas>
            </div>
          </div>
          <div class="result-item full-width">
            <span class="result-label">Predicted Remaining Semesters:</span>
            <div class="predictions-grid" id="predictions-grid">--</div>
            <div class="predictions-sparkline" id="predictions-sparkline"></div>
          </div>
          <div class="result-item">
            <span class="result-label">Risk Assessment:</span>
            <span class="result-value risk-badge" id="risk-assessment">--</span>
          </div>
          <div class="result-item">
            <span class="result-label">Recommendation:</span>
            <span class="result-insight" id="insight-text">--</span>
          </div>
          <div
            class="result-item full-width"
            id="warning-message-bottom"
            style="display: none"
          >
            <span class="result-label">Warning:</span>
            <span
              class="result-value"
              id="warning-text-bottom"
              style="color: red"
              >--</span
            >
          </div>
          <div class="result-item features-item">
            <span class="result-label">Key Performance Indicators:</span>
            <div class="features-list" id="features-list">--</div>
          </div>
        </div>
      </section>

      <!-- What-If Analysis Section -->
      <section class="whatif-section" id="whatif-section" style="display: none">
        <h2 class="section-title">üîÆ What-If Analysis</h2>
        <p class="section-subtitle">Explore how changes in your performance could affect your predicted CGPA</p>
        
        <div class="whatif-container">
          <div class="whatif-controls">
            <div class="whatif-control-group">
              <label class="whatif-label">
                <span class="whatif-label-text">Attendance Percentage</span>
                <span class="whatif-value" id="whatif-attendance-value">75%</span>
              </label>
              <input 
                type="range" 
                id="whatif-attendance" 
                class="whatif-slider" 
                min="0" 
                max="100" 
                value="75" 
                step="1"
              />
              <div class="whatif-range-labels">
                <span>0%</span>
                <span>100%</span>
              </div>
            </div>

            <div class="whatif-control-group">
              <label class="whatif-label">
                <span class="whatif-label-text">Midterm Performance</span>
                <span class="whatif-value" id="whatif-midterm-value">25/50</span>
              </label>
              <input 
                type="range" 
                id="whatif-midterm" 
                class="whatif-slider" 
                min="0" 
                max="50" 
                value="25" 
                step="1"
              />
              <div class="whatif-range-labels">
                <span>0</span>
                <span>50</span>
              </div>
            </div>

            <div class="whatif-control-group">
              <label class="whatif-label">
                <span class="whatif-label-text">Grade Improvement Target</span>
                <span class="whatif-value" id="whatif-grade-value">Current</span>
              </label>
              <select id="whatif-grade" class="whatif-select">
                <option value="0">Current Grades</option>
                <option value="0.3">Improve by 0.3 GPA</option>
                <option value="0.5">Improve by 0.5 GPA</option>
                <option value="1.0">Improve by 1.0 GPA</option>
              </select>
            </div>

            <button id="whatif-calculate" class="btn btn-primary whatif-btn">
              Calculate Impact
            </button>
          </div>

          <div class="whatif-results" id="whatif-results" style="display: none">
            <div class="whatif-result-card">
              <div class="whatif-result-icon">üìä</div>
              <div class="whatif-result-content">
                <div class="whatif-result-label">Predicted CGPA</div>
                <div class="whatif-result-value" id="whatif-predicted-cgpa">--</div>
                <div class="whatif-result-change" id="whatif-cgpa-change">--</div>
              </div>
            </div>

            <div class="whatif-result-card">
              <div class="whatif-result-icon">üéØ</div>
              <div class="whatif-result-content">
                <div class="whatif-result-label">Pass Probability</div>
                <div class="whatif-result-value" id="whatif-pass-prob">--</div>
                <div class="whatif-result-change" id="whatif-pass-change">--</div>
              </div>
            </div>

            <div class="whatif-result-card">
              <div class="whatif-result-icon">üí°</div>
              <div class="whatif-result-content">
                <div class="whatif-result-label">Outcome</div>
                <div class="whatif-result-insight" id="whatif-insight">--</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Recommendations Section -->
      <section class="recommendations-section" id="recommendations-section" style="display: none">
        <h2 class="section-title">üí° AI-Powered Recommendations</h2>
        <p class="section-subtitle">Personalized suggestions to improve your academic performance</p>
        
        <div class="recommendations-container" id="recommendations-container">
          <!-- Recommendations will be dynamically generated -->
        </div>
      </section>

      <!-- Subject-Specific Predictions Section -->
      <section class="subject-predictions-section" id="subject-predictions-section" style="display: none">
        <h2 class="section-title">üìö Subject-Specific Performance Analysis</h2>
        <p class="section-subtitle">Individual subject predictions and targeted recommendations</p>
        
        <div class="subject-predictions-container">
          <!-- Subject Performance Overview -->
          <div class="subject-overview-cards" id="subject-overview-cards">
            <!-- Will be dynamically generated -->
          </div>

          <!-- Subjects Needing Attention -->
          <div class="attention-section" id="attention-section" style="display: none">
            <h3 class="subsection-title">‚ö†Ô∏è Subjects Requiring Attention</h3>
            <div class="attention-subjects-grid" id="attention-subjects-grid">
              <!-- Will be dynamically generated -->
            </div>
          </div>

          <!-- Strong Subjects -->
          <div class="strong-section" id="strong-section" style="display: none">
            <h3 class="subsection-title">üåü Your Strong Subjects</h3>
            <div class="strong-subjects-grid" id="strong-subjects-grid">
              <!-- Will be dynamically generated -->
            </div>
          </div>

          <!-- Subject-wise Predictions Chart -->
          <div class="subject-chart-section">
            <h3 class="subsection-title">üìä Subject Performance Comparison</h3>
            <div class="subject-chart-container">
              <canvas id="subject-comparison-chart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Buttons -->
      <div class="button-group">
        <button class="btn btn-primary" id="predict-btn">
          Predict Grade
        </button>
        <button class="btn btn-secondary" id="reset-btn">Reset</button>
      </div>

      <!-- Error/Success Messages -->
      <div class="message-container">
        <div
          id="error-message"
          class="message error-message"
          style="display: none"
        ></div>
        <div
          id="success-message"
          class="message success-message"
          style="display: none"
        ></div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
